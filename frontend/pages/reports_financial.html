<div class="section">
  <h2>Financial Report</h2>
  <table id="fr_table">
    <thead><tr><th>Date</th><th>Budget Line</th><th>Cost</th><th>Currency</th><th>Notes</th></tr></thead>
    <tbody></tbody>
  </table>
  <button onclick="addFrRow()">Add Expenditure</button>
  <button onclick="submitFr()">Submit Financial Report</button>
</div>
<script>
function addFrRow(){
  const tb=document.querySelector("#fr_table tbody");
  const tr=document.createElement("tr");
  ["date","text","number","text","text"].forEach(type=>{
    const td=document.createElement("td");
    td.innerHTML = "<input type='"+type+"'>";
    tr.appendChild(td);
  });
  tb.appendChild(tr);
}
async function submitFr(){
  const rows=Array.from(document.querySelectorAll("#fr_table tbody tr"));
  const entries=rows.map(tr=>{
    const [d,b,c,cur,n]=Array.from(tr.querySelectorAll("input")).map(i=>i.value);
    return { date:d, budget_line:b, cost:c, currency:cur, notes:n };
  });
  const res=await postJSON("/financial-report",{ entries });
  if(res && !res.detail) showNotice("success","Financial report submitted");
  else showNotice("error","Error submitting financial report");
}
addFrRow();
</script>
